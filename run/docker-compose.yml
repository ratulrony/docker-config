redis:
    image: redis:latest
    volumes:
    - /data/docker/thumbsniper/redis:/data
    command: "redis-server --appendonly yes"

mongo:
    image: mongo:latest
    volumes:
    - /data/docker/thumbsniper/mongo:/data/db
    command: "--smallfiles"

mongo-seed:
    image: thumbsniper/mongo-seed:latest
    environment:
    - MONGODBNAME=thumbsniper
    - MONGOUSER=thumbsniper
    - MONGOPASS=secret
    links:
    - mongo

php-fpm:
    image: thumbsniper/php-fpm:latest
    volumes:
    - /opt/thumbsniper
    - /data/docker/thumbsniper/thumbnails:/opt/thumbsniper/web_images/thumbnails
    links:
    - mongo
    - redis

nginx-api:
    image: thumbsniper/nginx-api:latest
    volumes_from:
    - php-fpm
    links:
    - php-fpm

nginx-images:
    image: thumbsniper/nginx-images:latest
    volumes_from:
    - php-fpm
    links:
    - php-fpm

nginx-panel:
    image: thumbsniper/nginx-panel:latest
    volumes_from:
    - php-fpm
    links:
    - php-fpm

proxy:
    image: thumbsniper/proxy:latest
    links:
    - nginx-api
    - nginx-images
    - nginx-panel
    ports:
    - "80:80"

agent-normal:
    image: thumbsniper/agent:latest
    links:
    - proxy:api.example.com
    - proxy:img.example.com
    environment:
    - TAGENT_QUEUE=normal

agent-longrun:
    image: thumbsniper/agent:latest
    links:
    - proxy:api.example.com
    - proxy:img.example.com
    environment:
    - TAGENT_QUEUE=longrun

agent-image:
    image: thumbsniper/agent:latest
    links:
    - proxy:api.example.com
    - proxy:img.example.com
    environment:
    - TAGENT_QUEUE=image

